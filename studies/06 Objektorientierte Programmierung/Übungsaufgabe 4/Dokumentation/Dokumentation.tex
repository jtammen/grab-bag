%%% File-Information {{{
%%% Filename: template_bericht.tex
%%% Purpose: lab report, technical report, project report
%%% Time-stamp: <2004-06-30 18:19:32 mp>
%%% Authors: The LaTeX@TUG-Team [http://latex.tugraz.at/]:
%%%          Karl Voit (vk), Michael Prokop (mp), Stefan Sollerer (ss)
%%% History:
%%%   20040630 (mp) added comments to foldmethod at end of file
%%%   20040625 (vk,ss) initial version
%%%
%%% Notes:
%%%
%%%
%%%
%%% }}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% main document {{{

\documentclass[
a4paper,     %% defines the paper size: a4paper (default), a5paper, letterpaper, ...
% landscape,   %% sets the orientation to landscape
% twoside,     %% changes to a two-page-layout (alternatively: oneside)
% twocolumn,   %% changes to a two-column-layout
headsepline, %% add a horizontal line below the column title
footsepline, %% add a horizontal line above the page footer
titlepage,   %% only the titlepage (using titlepage-environment) appears on the first page (alternatively: notitlepage)
halfparskip,     %% insert an empty line between two paragraphs (alternatively: halfparskip, ...)
% leqno,       %% equation numbers left (instead of right)
% fleqn,       %% equation left-justified (instead of centered)
% tablecaptionabove, %% captions of tables are above the tables (alternatively: tablecaptionbelow)
%draft,       %% produce only a draft version (mark lines that need manual edition and don't show graphics)
% 10pt         %% set default font size to 10 point
12pt,         %% set default font size to 11 point
DIV16
]{scrartcl}  %% article, see KOMA documentation (scrguide.dvi)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%
%%% packages
%%%

\usepackage{pstricks}
\usepackage{uml}

%%%
%%% encoding and language set
%%%

%%% ngerman: language set to new-german
\usepackage{ngerman}

%%% inputenc: coding of german special characters
\usepackage[latin1]{inputenc}

%%% fontenc, ae, aecompl: coding of characters in PDF documents
\usepackage[T1]{fontenc}
\usepackage{ae,aecompl}

%%%
%%% technical packages
%%%

%%% amsmath, amssymb, amstext: support for mathematics
\usepackage{amsmath,amssymb,amstext}

%%% psfrag: replace PostScript fonts
\usepackage{psfrag}

%%% listings: include programming code
\usepackage{listings}
\usepackage{moreverb}

%%% units: technical units
\usepackage{units}

%%% color: support for ... colors, yes!
\usepackage{color}

%%% graphs and automata (has to be loaded _before_ ngerman)
\usepackage{pstricks}
\usepackage{vaucanson-g}

%%% table-stuff
\usepackage{booktabs}
\usepackage{array}
\usepackage{multirow}

\newcolumntype{N}{>{\bfseries\scriptsize}l}
\newcolumntype{V}[1]{%
	>{\bfseries\scriptsize\raggedright\hspace{0pt}}p{#1}%
}

%%% some color-definitions (see http://texnik.de/listings/listing0.pdf)
\definecolor{hellgelb}{rgb}{1,1,0.8}
\definecolor{hellgrau}{rgb}{0.9,0.9,0.9}
\definecolor{colKeys}{rgb}{0,0,1}
\definecolor{colIdentifier}{rgb}{0,0,0}
\definecolor{colComments}{rgb}{1,0,0}
\definecolor{colString}{rgb}{0,0.5,0}

%%% configuration of the listings-package
\lstset{%
	float=hbp,%
	basicstyle=\ttfamily\small, %
	identifierstyle=\color{colIdentifier}, %
	keywordstyle=\color{colKeys}, %
	stringstyle=\color{colString}, %
	commentstyle=\color{colComments}, %
	columns=flexible, %
	tabsize=4, %
	frame=tb, %
	extendedchars=true, %
	showspaces=false, %
	showstringspaces=false, % 
	numbers=left, %
	numberstyle=\tiny, %
	breaklines=true, %
	backgroundcolor=\color{hellgrau}, %
	breakautoindent=true, %
	captionpos=b%
}

%%%
%%% layout
%%%

%%% scrpage2: KOMA heading and footer
%%% Note: if you don't use this package, please remove 
%%%       \pagestyle{scrheadings} and corresponding settings
%%%       below too.
\usepackage{scrpage2}

%%% EM unterstrichen darstellen
%\usepackage{ulem}

%%% Schrift fuer Captions verkleinern
\setkomafont{captionlabel}{\scriptsize}
\setkomafont{caption}{\usekomafont{captionlabel}}

%%% Float
\usepackage{float}

%%%
%%% PDF
%%%

\newif\ifpdf
  \ifx\pdfoutput\undefined
     \pdffalse
  \else
     \pdfoutput=1
     \pdftrue
  \fi

%%% Should be LAST usepackage-call!
%%% For docu on that, see reference on package ``hyperref''
\ifpdf{%   (definitions for using pdflatex instead of latex)

	%%% for screen (PDF), we use sans-serif-fonts
	\usepackage{mathpazo}
	\usepackage[scaled=.95]{helvet}
	\usepackage{courier}	
	\renewcommand{\familydefault}{\sfdefault}
	\usepackage[sf]{titlesec}

  %%% graphicx: support for graphics
  \usepackage[pdftex]{graphicx}
 
  \pdfcompresslevel=9

  %%% hyperref (hyperlinks in PDF): for more options or more detailed
  %%%          explanations, see the documentation of the hyperref-package
  \usepackage[%
    %%% general options
    pdftex=true,      %% sets up hyperref for use with the pdftex program
    %plainpages=false, %% set it to false, if pdflatex complains: ``destination with same identifier already exists''
    %
    %%% extension options
    backref=section,   %% if true, adds a backlink text to the end of each item in the bibliography
    pagebackref=false, %% if true, creates backward references as a list of page numbers in the bibliography
    colorlinks=true,   %% turn on colored links (true is better for on-screen reading, false is better for printout versions)
    %
    %%% PDF-specific display options
    bookmarks=true,          %% if true, generate PDF bookmarks (requires two passes of pdflatex)
    bookmarksopen=false,     %% if true, show all PDF bookmarks expanded
    bookmarksnumbered=false, %% if true, add the section numbers to the bookmarks
    %pdfstartpage={1},        %% determines, on which page the PDF file is opened
    pdfpagemode=None,	       %% None, UseOutlines (=show bookmarks), UseThumbs (show thumbnails), FullScreen
    breaklinks=true         
  ]{hyperref}

  %%% provide all graphics (also) in this format, so you don't have
  %%% to add the file extensions to the \includegraphics-command
  %%% and/or you don't have to distinguish between generating
  %%% dvi/ps (through latex) and pdf (through pdflatex)
  \DeclareGraphicsExtensions{.pdf}
  \graphicspath{{./images}}

\else    %(definitions for using latex instead of pdflatex)

  \usepackage[dvips]{graphicx}

  \DeclareGraphicsExtensions{.eps}
  \graphicspath{{./images}}  

  \usepackage[%
    dvips,            %% sets up hyperref for use with the dvips driver
    colorlinks=false, %% better for printout version; almost every hyperref-extension is eliminated by using dvips
    breaklinks=true 
  ]{hyperref}

\fi %ifpdf

%%% sets the PDF-Information options
%%% (see fields in Acrobat Reader: ``File -> Document properties -> Summary'')
%%% Note: this method is better than as options of the hyperref-package (options are expanded correctly)
\hypersetup{
  pdftitle={Komprimierung}, %%
  pdfauthor={Jan Tammen <foobar@fh-konstanz.de>, Christoph Eck <ceck@fh-konstanz.de>}, %%
  pdfsubject={Objektorientierte Programmierung, Übungsaufgabe 4}, %%
  pdfcreator={Jan Tammen <foobar@fh-konstanz.de>}, %% 
  pdfproducer={}, %%
  pdfkeywords={} %%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%
%%% user defined commands
%%%

%%% \mygraphics{}{}{}
%% usage:   \mygraphics{width}{filename_without_extension}{caption}
%% example: \mygraphics{0.7\textwidth}{rolling_grandma}{This is my grandmother on inlinescates}
%% requires: package graphicx
%% provides: including centered pictures/graphics with a boldfaced caption below
%% 
\newcommand{\mygraphics}[3]{
  \begin{center}
    \includegraphics[width=#1, keepaspectratio=true]{#2} \\
    \textbf{#3}
  \end{center}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%
%%% define the titlepage
%%%

% \subject{}   %% subject which appears above titlehead
% \titlehead{} %% special heading for the titlepage

%%% title
\title{Komprimierung}
\subject{Objektorientierte Programmierung, Übungsaufgabe 4}

%%% author(s)
\author{Jan Tammen \href{mailto:foobar@fh-konstanz.de}{<foobar@fh-konstanz.de>}
					\and{%
						Christoph Eck \href{mailto:ceck@fh-konstanz.de}{<ceck@fh-konstanz.de>}
					}%
				}%

%\publishers{Ort der Durchführung: EDC-Labor, FH Konstanz.\\
%						Datum: 16.12.2004}

\date{\today}

% \thanks{} %% use it instead of footnotes (only on titlepage)

% \dedication{} %% generates a dedication-page after titlepage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%
%%% set heading and footer
%%%

%%% scrheadings default: 
%%%      footer - middle: page number
\pagestyle{scrheadings}

%%% user specific
%%% usage:
%%% \position[heading/footer for the titlepage]{heading/footer for the rest of the document}

%%% heading - left
% \ihead[]{}

%%% heading - center
% \chead[]{}

%%% heading - right
% \ohead[]{}

%%% footer - left
% \ifoot[]{}

%%% footer - center
% \cfoot[]{}

%%% footer - right
% \ofoot[]{}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%
%%% begin document
%%%
\begin{document}

% \pagenumbering{roman} %% small roman page numbers

%%% include the title
%\thispagestyle{empty}  %% no header/footer (only) on this page
\maketitle

%%% start a new page and display the table of contents
%\newpage
%\tableofcontents

%%% start a new page and display the list of figures
%\newpage
%\listoffigures

%%% start a new page and display the list of tables
% \newpage
% \listoftables

%%% display the main document on a new page 
\newpage

% \pagenumbering{arabic} %% normal page numbers (include it, if roman was used above)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%
%%% begin main document
%%% structure: \section \subsection \subsubsection \paragraph \subparagraph
%%%

\section{Einleitung}
Ein beliebiger Text soll mittels der {\em Huffman-Codierung} komprimiert werden. Bei diesem
Verfahren werden zunächst die Häufigkeiten der Zeichen im Quelltext bestimmt. Anschliessend 
werden die einzelnen Zeichen mit einem Bitcode variabler Länge codiert; häufig auftretende
Zeichen bekommen einen kurzen, selten auftretende Zeichen einen längeren Code zugewiesen.

Für einen beliebigen Eingabetext soll zum einen der optimale \textit{Huffman-Code}, 
zum anderen der theoretische sowie der praktische \textit{Reduktionsfaktor} ermittelt werden.

\subsection{Algorithmus}
Der Algorithmus zur Erstellung der Huffman-Codierung lässt sich wie folgt zusammenfassen:

\begin{enumerate}
	\item Bestimmung der Zeichenhäufigkeiten im Quelltext.
	\item Für jedes auftretende Zeichen einen \textbf{Blattknoten} generieren; 
				dieser Knoten enthält das Zeichen \textit{c} sowie die Häufigkeit \textit{h}.
	\item Die beiden Knoten mit der geringsten Häufigkeit bekommen einen gemeinsamen
				Elternknoten; dieser enthält die \textbf{Summe der Häufigkeiten} der beiden Kindknoten,
				sowie eine mit '0' bezeichnete \textbf{Verzweigung} zum linken und eine mit '1' bezeichnete
				\textbf{Verzweigung} zum rechten Kindknoten.
	\item Die beiden Kindknoten als bearbeitet, den neu erzeugte Elternknoten als nicht bearbeitet markieren.
	\item Falls es noch unbearbeitete Knoten gibt: fortfahren mit Schritt 3.
	\item Abschließend wird der Baum traversiert und dabei der Bitcode für die einzelnen Zeichen erstellt 
	(links: 0, rechts: 1)
\end{enumerate}

\section{Datenstrukturen und Methoden}

\subsection{Bestimmung der Zeichenhäufigkeiten}
Für die Speicherung der Zeichenhäufigkeiten wird der STL-Datentyp \texttt{vector} benutzt.
Die Quelldatei wird Zeichen für Zeichen eingelesen und dabei wird jeweils der entsprechende
Wert für das aktuelle Zeichen im Array inkrementiert. Als Schlüssel dient dabei der ASCII-Code
des Zeichens.

\subsection{Huffman-Baum aufbauen}

\subsubsection{Datenstruktur: Knoten und Blätter}
Für die inneren Knoten und Blätter (hier "`AussenKnoten"' genannt) wird eine kleine Klassenhierarchie verwendet, deren Struktur im folgenden Diagramm
aufgezeigt ist.

\begin{figure}[H]
	\centering
		\input klassendiagramm%
	\caption{UML-Klassendiagramm}
	\label{fig:classdiagram}
\end{figure}

In der Basisklasse \texttt{Knoten} wird die Häufigkeit des Zeichens bzw. die Summenhäufigkeit
der beiden Kindsknoten abgelegt. Weiterhin gibt es einen Vergleichsoperator, welcher für die 
Sortierung innerhalb der Vorrangwarteschlange benötigt wird.

Ein \texttt{InnenKnoten} hat zusätzlich zwei Kindsknoten, welche über entsprechende Zeiger erreicht werden können.
Ein \texttt{AussenKnoten} hingegen hat keine weiteren Verzweigungen, allerdings wird hier noch das 
durch ihn repräsentierte Zeichen gespeichert.


\subsubsection{Algorithmus}
Um den Huffman-Baum zu erstellen, wird zunächst für jedes Element des Zeichenhäufigkeiten-Vektors ein Blattknoten
angelegt und anschließend in eine Vorrangwarteschlange (die STL bietet hier den effizienten Datencontainer \texttt{priority\_queue} auf Basis eines Heaps an) eingefügt.
Somit werden die Blätter automatisch nach ihrer Häufigkeit aufsteigend sortiert vorgehalten (die Sortierung erfolgt
über den \texttt{operator<}).

Anschließend werden in einer Schleife jeweils zwei Elemente aus der Schlange entfernt,
um daraus den Elternknoten zu erstellen (Addition der Häufigkeiten und Verzeigerung der Kindsknoten).
Die Schleife endet, wenn nur noch ein Element in der Schlange vorhanden ist -- die Wurzel des Baumes ist erreicht.

\subsubsection{Pseudocode}
\begin{lstlisting}[language=Pseudo,caption={Pseudocode Aufbau Huffman-Baum}]
pq = <Vorrangwarteschlange>
sf = <Array mit Zeichenhäufigkeiten>		/// Länge 256, initialisiert mit 0

for <i> from 0 to <Länge sf> do
	if <sf[i] != 0> then			/// Häufigkeit ist nicht Null
		Knoten node()
		node.zeichen = i
		node.haeufigkeit = sf[i]
		pq.push( node )
	end if
end for

while <Größe von pq > 1> do
	kindLinks = pq.top()      /// oberstes Element holen
	pq.pop()                  /// anschliessend loeschen
	kindRechts = pq.top()     /// naechstes holen
	pq.pop()                  /// ebenfalls loeschen
	
	elternKnoten = <neuer Knoten mit Summe + Zeigern>
	pq.push( elternKnoten ) /// neu erstellten Knoten einfuegen
end while
\end{lstlisting}


\subsection{Textuelle Repräsentation des Huffman-Baums}
Um die codierte Datei später wieder decodieren zu können, muss eine möglichst kompakte
Darstellung des Code-Baumes in einer Datei gespeichert (z.B. am Anfang der codierten Datei) und zusätzlich zum
Empfänger übertragen werden.

Dazu müssen in diese Code-Datei lediglich alle vorkommenden Zeichen mit der dazugehörigen Häufigkeit gespeichert
werden; daraus lässt sich dann vor dem Decodieren der Huffman-Baum mittels des oben aufgeführten Algorithmus' wieder aufbauen.

\subsection{Text codieren}
Um nicht bei jedem Eingabe-Zeichen den Baum nach dem Code durchsuchen zu müssen, wird zunächst eine Zuordnungsstruktur
(STL-Datencontainer \texttt{map}) eingesetzt. Dort werden alle Zeichen mit dem dazugehörigen Code eingetragen.

Den Code für jedes Zeichen erhält man durch \textbf{Traversieren} des Huffman-Baums. Dabei wird
das aktuelle Code-Bit (links: 0, rechts: 1) in einen Stack eingefügt. Beim Erreichen eines Blattes wird der 
komplette Code samt Zeichen in die Zuordnungstabelle eingetragen und das letzte Bit aus 
dem Stack entfernt und mit dem Traversieren fortgefahren.

\subsection{Ermittlung des Reduktionsfaktors}
Beim Einlesen des Quelltextes wird die Gesamtanzahl der Zeichen ermittelt; multipliziert
man diesen Wert mit der vom verwendeten Zeichensatz benötigten Bitanzahl (z.B. ASCII 8Bit), erhält man
den Gesamtspeicherbedarf des Quelltextes.

Der Speicherbedarf des codierten Textes ergibt sich aus der Summe der Zeichenhäufigkeiten multipliziert
mit der Codelänge des Zeichens.

Setzt man diese beiden Werte in Relation zueinander, erhält man den \textsl{theoretischen Reduktionsfaktor}. 
Für den \textsl{praktischen Reduktionsfaktor} muss zusätzlich der Speicherbedarf der Code-Tabelle berücksichtigt
werden. Dieser errechnet sich aus der Anzahl der verschiedenen Zeichen multipliziert mit 5 Byte 
(typischerweise 1 Byte für das Zeichen (\texttt{char}) + 4 Byte für die Häufigkeit (\texttt{int})).

\section{Programmaufbau}
Alle Funktionen, die der Erstellung des Huffman-Codes -- und schließlich der Codierung/Decodierung von Dateien --
dienen (Zeichenhäufigkeit bestimmen, Huffman-Baum erstellen, etc.)
werden in einer Anwendungsklasse \texttt{Huffman} gekapselt; nachfolgend das UML-Klassendiagramm.

\begin{figure}[H]
	\centering
		\input klassendiagrammhuffman%
	\caption{UML-Klassendiagramm}
	\label{fig:classdiagramhuffman}
\end{figure}

%%%
%%% end main document
%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\appendix  %% include it, if something (bibliography, index, ...) follows below

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%
%%% bibliography
%%%
%%% available styles: abbrv, acm, alpha, apalike, ieeetr, plain, siam, unsrt
%%%
% \bibliographystyle{plain}

%%% name of the bibliography file without .bib
%%% e.g.: literatur.bib -> \bibliography{literatur}
% \bibliography{FIXXME}

\end{document}
%%% }}}
%%% END OF FILE
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Notice!
%%% This file uses the outline-mode of emacs and the foldmethod of Vim.
%%% Press 'zi' to unfold the file in Vim.
%%% See ':help folding' for more information.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Local Variables:
%% mode: outline-minor
%% OPToutline-regexp: "%% .*"
%% OPTeval: (hide-body)
%% emerge-set-combine-versions-template: "%a\n%b\n"
%% End:
%% vim:foldmethod=marker